; -----------------------------------------------------------
; -------------------- HEADERS CONFIG -----------------------
; -----------------------------------------------------------
.include "header.asm"
; -----------------------------------------------------------

.segment "ZEROPAGE"

; -----------------------------------------------------------
; ---------------- CONSTANTS AND VARIABLES ------------------
; -----------------------------------------------------------
.include "common/registers.asm"
.include "common/variables.asm"
; -----------------------------------------------------------

.segment "STARTUP"
.segment "CODE"

; -----------------------------------------------------------
; -------------------- GENERAL INCLUDES ---------------------
; -----------------------------------------------------------
.include "common/subroutines.asm"

; -----------------------------------------------------------
; -------------------------- MAIN ---------------------------
; -----------------------------------------------------------
main:
.include "init.asm"
.include "ppu.asm"
.include "apu.asm"

infiniteLoop:
  JMP infiniteLoop

; -----------------------------------------------------------
; -------------------------- NMI ----------------------------
; -----------------------------------------------------------
; Reference guide: https://www.nesdev.org/wiki/NMI
nmi:
  LDA #$00
  STA OAMADDR
  LDA #$02
  STA OAMDMA

  LDA figure
  STA $0233
  STA $023B
  TAX
  CLC
  ADC #$08
  STA $0237
  STA $023F
  INX
  STX figure

  RTI

; -----------------------------------------------------------
; -------------------------- DATA ---------------------------
; -----------------------------------------------------------
.include "data.asm"

.segment "VECTORS"
  .word nmi
  .word main
  .word 0

.segment "CHARS"

.incbin "sprites/mario.chr"